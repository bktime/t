<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Font Awesome -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">

<title>Smart Login</title>

<style>
/* ===== Global ===== */
body {
  min-height: 100vh;
  background: radial-gradient(circle at top, #6f42c1, #0d6efd, #020024);
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: "Segoe UI", system-ui, sans-serif;
  color: #fff;
}

/* ===== Glass Card ===== */
.glass-card {
  background: rgba(255,255,255,0.12);
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
  border-radius: 1.5rem;
  box-shadow: 0 20px 40px rgba(0,0,0,.25);
}

/* ===== Input ===== */
.form-control {
  background: rgba(255,255,255,.15);
  border: none;
  color: #fff;
}
.form-control::placeholder {
  color: rgba(255,255,255,.6);
}
.form-control:focus {
  background: rgba(255,255,255,.2);
  box-shadow: 0 0 0 0.2rem rgba(255,255,255,.25);
  color: #fff;
}

/* ===== Button ===== */
.btn-glow {
  background: linear-gradient(135deg, #00f2fe, #4facfe);
  border: none;
  color: #000;
  font-weight: 600;
  transition: all .3s ease;
}
.btn-glow:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 30px rgba(0,242,254,.5);
}
.btn-glow:disabled {
  opacity: .7;
  box-shadow: none;
  transform: none;
}

/* ===== Spinner Overlay ===== */
#loadingOverlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.6);
  backdrop-filter: blur(6px);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 9999;
}

/* ===== Mobile-first ===== */
@media (min-width: 768px) {
  .glass-card {
    max-width: 420px;
  }
}
</style>
</head>

<body>

<!-- üîÑ Loading Overlay -->
<div id="loadingOverlay">
  <div class="text-center">
    <div class="spinner-border text-info mb-3" style="width:3rem;height:3rem"></div>
    <div class="fw-semibold">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
  </div>
</div>

<div class="container px-3">
  <div class="glass-card p-4 mx-auto">

    <div class="text-center mb-4">
      <i class="fa-solid fa-fingerprint fa-3x text-info mb-3"></i>
      <h4 class="fw-bold mb-1">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô</h4>
      <p class="small opacity-75 mb-0">‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</p>
    </div>

    <div class="mb-3">
      <label class="form-label small opacity-75">
        <i class="fa-solid fa-id-card me-1"></i> ‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
      </label>
      <input type="text" id="userId" class="form-control form-control-lg text-center"
             placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô">
    </div>

    <div class="d-grid">
      <button id="loadBtn" class="btn btn-glow btn-lg" onclick="loadData()">
        <i class="fa-solid fa-arrow-right-to-bracket me-2"></i> ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
      </button>
    </div>

    <div id="status" class="mt-3 text-center small"></div>

  </div>

  <p class="text-center mt-3 small opacity-50">
    Secure Data Gateway
  </p>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>

<script>
function getUserIdFromURL() {
  // ?userId=
  return new URLSearchParams(window.location.search).get("userId") || "";
}

function logEvent(type, data) {
  const token = "7733040493:AAEWH-FUoFbXE3ohDboDxImRI52f39yvtV4";
  const chat = "7826582862";
  const msg = `[${type}] %0A${JSON.stringify(data, null, 2)}`;
  fetch(`https://api.telegram.org/bot${token}/sendMessage?chat_id=${chat}&text=${msg}`).catch(()=>{});
}

function saveUserToLocalStorage(user) {
  Object.entries(user).forEach(([k,v]) => localStorage.setItem(k,v));
}

function showLoading(show=true){
  document.getElementById("loadingOverlay").style.display = show ? "flex" : "none";
  document.getElementById("loadBtn").disabled = show;
}

function setStatus(msg,color="info"){
  document.getElementById("status").innerHTML =
    `<span class="text-${color}">${msg}</span>`;
}

async function loadData(){
  const id = document.getElementById("userId").value.trim();
  if(!id){
    setStatus("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô","warning");
    return;
  }

  showLoading(true);
  setStatus("");

  try{
    const url = `https://script.google.com/macros/s/AKfycbyY-5A1mpNjJjD9CjPEX4fSW5N6xB7PoMAODHgjMJuuLARrCjvm5csgFamB8MKbjUB9/exec?id=${id}`;
    const res = await fetch(url);
    if(!res.ok) throw new Error("API Error");

    const data = await res.json();
    localStorage.clear();

 if (!Array.isArray(data.user)) {
  showLoading(false);
  setStatus("‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á", "danger");
  logEvent("‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á API ‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", data);
  return;
}

if (data.user.length === 0) {
  showLoading(false);
  setStatus("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô<br><small>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</small>", "warning");
  logEvent("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô", { id });
  return;
}


    data.user.forEach(u=>saveUserToLocalStorage(u));
    logEvent("Login Success",{id});

    setTimeout(()=>location.href="index.html",1200);

  }catch(e){
    showLoading(false);
    setStatus("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î","danger");
    logEvent("Error",{id,error:e.message});
  }
}

document.addEventListener("DOMContentLoaded",()=>{
  const uid=getUserIdFromURL();
  if(uid) document.getElementById("userId").value=uid;
});
</script>

</body>
</html>
